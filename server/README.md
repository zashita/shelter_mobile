# МИКРОДОКА ПО РАЗВЁРТЫВАНИЮ MIO.MI API

Выполняем по очерёдности следования глав.

## 1. ПОДГОТОВКА МАШИНЫ (ЕСЛИ НЕ УМЕЕМ КОНТЕЙНЕРИЗИРОВАТЬ)

1. Я создаю свой софт для того чтобы закоренелые виндузятники страдали, поэтому сторого рекомендую ставить СОФТИНУ на GNU/LINUX, BSD и прочие \*NIX системы.

2. Если же с винды переходить не хочется, то ставим следующие пакеты:

   PostgreSQL 14 и выше

   NodeJS 16 и выше

   Nginx, Apache, Denver 3 веб-сервера по необходимости

3. Проверяем демон PostgreSQL и по желанию ставим в автозапуск. Без него бек не заработает.

4. Машина готова к работе бэкэнда.

## 2. Установка зависимостей

1. Вместе с пакетом NodeJS идёт пакет NPM. Это пакетный менеджер, который доставит наши зависимоти. Волшебным мановением руки по клавиатуре ставим зависимости через команду:

   `npm i`

2. Альтернативно, можно доставить зависимости через пакетный менеджер Yarn. Он справляется с их установкой быстрее, но это пункт со звёздочкой, для того чтобы его доставить нужно выполнить следующую последовательность команд:

   `npm i -g yarn`

   `yarn`

## 3. ЗАПОЛНЕНИЕ СРЕДЫ

1. Создаётся `.env` файл в корне проекта и заполняется по примеру `.env.example`. Это необходимо для того, чтобы правильно работали ORM и загрузка файлов, а также внешний порт, на котором происходит взаимодействие с сервисом.

## 4. ЗАПУСК

1. В корне проекта запускаем:

   `npm run start`

## 5. ЭНДПОИНТЫ

1. По пути `src/moules/` лежат модули приложения. Каждый модуль имеет контроллер (controller), сущность БД (entitiy), объёкт передачи данных (dto) и т.д. Находим интересующий нас контроллер.

2. Контроллеры описаны как декорированные методы в классе. Декораторы `@Get`, `@Post` и `@Delete` соответствуют методам HTTP. А то, что они принимают определяется декораторами `@Body`, `@Param`, `@Query`. Главное уметь читать код и весь функционал будет понятен. Я старался сделать его максимально self-explanatory.

3. `@Body` - классическое тело запроса формата JSON. Главное на фронте не забыть выставить `Content-Type: application/json` как один из хедеров запроса. Поля тела определены в dto файлах соответвующего каталога и указаны в аргументах метода-эндпоинта. Пример POST запроса для создания нового тэга для животных:

   URL:

   `http://0.0.0.0:8000/tags`

   Body:

   `{
    "name": "тестовый тег"
}`

   \*Возможна обработка `form-data` тела запроса, которая немного сложнее, но реализована в сервисе.

4. `@Param` - одиночный текстовый параметр в URL. Обычно является ID какой-нибудь строки или сущности в БД. Пример DELETE запроса для удаления тега:

   `http://0.0.0.0:8000/tags/2`

5. `@Query` - строка формата query parameters. Может быть как с так и без urlencoded кодировки. Первый параметр указывается в URL через `?`, а все последующие через `&`. Пример фильтрации животных через GET запрос:

   `http://0.0.0.0:8000/animals?ageMin=16&ageMax=22&sex=M&size=L&name=Гена&species=2&tags=1&tags=2&tags=3`
